<template>
  <div class="app-container">
    <!-- 1. å·¦ä¾§åŠŸèƒ½å¯¼èˆªæ  (Left Sidebar) -->
    <aside class="left-sidebar">
      <div class="brand">
        <span class="logo-icon">ğŸ“š</span>
        <span class="logo-text">PaperLearn</span>
      </div>
      
      <nav class="nav-menu">
        <button class="nav-btn primary" @click="handleRefresh">
          <span class="icon">ğŸ”„</span> åˆ·æ–°å†…å®¹
        </button>
        <button class="nav-btn" @click="handleGenerate">
          <span class="icon">âœ¨</span> é—®é¢˜ç”Ÿæˆ
        </button>
        <button class="nav-btn" @click="goHome">
          <span class="icon">ğŸ </span> å›åˆ°é¦–é¡µ
        </button>
        
        <div class="divider"></div>
        
        <button class="nav-btn" @click="filterNews">
          <span class="icon">ğŸ“°</span> æ–°é—»é—®é¢˜
        </button>
        <button class="nav-btn" @click="smartRecommend">
          <span class="icon">ğŸ§ </span> æ™ºèƒ½æ¨è
        </button>
      </nav>

      <div class="bottom-status">
        <span class="status-dot"></span> åœ¨çº¿
      </div>
    </aside>

    <!-- 2. ä¸­é—´ä¸»è¦å†…å®¹åŒº (Main Content) -->
    <main class="main-content">
      <!-- é¡¶éƒ¨æ ‡é¢˜åŒº -->
      <header class="content-header">
        <div class="topic-tag">å½“å‰è¯¾é¢˜</div>
        <h1 class="main-title">{{ sampleTitle || 'ç‚¹å‡»ç”Ÿæˆé—®é¢˜æˆ–è¾“å…¥å¼€å§‹å­¦ä¹ ' }}</h1>
        <div class="difficulty-badge" :class="difficultyLevel">
          {{ difficultyLevel === 'hard' ? 'éš¾åº¦ï¼šé«˜' : 'éš¾åº¦ï¼šé€‚ä¸­' }}
        </div>
      </header>

      <!-- æ ¸å¿ƒåŠŸèƒ½ï¼š5ä¸ªæ­¥éª¤æ‹†è§£ -->
      <div class="steps-container">
        <div v-for="(step, index) in steps" :key="index" class="step-card">
          <div class="step-indicator">
            <div class="step-number">Step {{ index + 1 }}</div>
            <div class="step-line" v-if="index < 4"></div>
          </div>
          
          <div class="step-content">
            <div class="step-header">
              <h3 class="step-title">{{ step.keyword }}</h3>
              <span class="step-column-tag">{{ step.column }}</span>
            </div>

            <!-- è®ºæ–‡åˆ—è¡¨ -->
            <div class="papers-list">
              <!-- è®ºæ–‡ 1 -->
              <div class="paper-item" v-if="step.paper1">
                <div class="paper-icon">ğŸ“„</div>
                <div class="paper-info">
                  <h4 class="paper-title">{{ step.paper1.title }}</h4>
                  <p class="paper-author">ä½œè€…: {{ step.paper1.author }}</p>
                  <div class="paper-abstract">
                    <strong>AI æ€»ç»“:</strong> {{ step.paper1.abstract }}
                  </div>
                </div>
              </div>
              <div v-else class="no-paper">æš‚æ— è®ºæ–‡æ•°æ®</div>

              <!-- è®ºæ–‡ 2 -->
              <div class="paper-item" v-if="step.paper2">
                <div class="paper-icon">ğŸ“„</div>
                <div class="paper-info">
                  <h4 class="paper-title">{{ step.paper2.title }}</h4>
                  <p class="paper-author">ä½œè€…: {{ step.paper2.author }}</p>
                  <div class="paper-abstract">
                    <strong>AI æ€»ç»“:</strong> {{ step.paper2.abstract }}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- æœ€åæ€»ç»“ -->
      <div class="final-summary-card">
        <div class="summary-header">
          <span class="icon">ğŸ“</span> å­¦ä¹ æ€»ç»“
        </div>
        <div class="summary-body">
          {{ summaryContent || 'å®Œæˆä¸Šè¿°æ­¥éª¤åï¼ŒAIå°†åœ¨æ­¤ç”Ÿæˆæœ€ç»ˆçš„å­¦ä¹ æ€»ç»“æŠ¥å‘Šã€‚' }}
        </div>
      </div>
    </main>

    <!-- 3. å³ä¾§ AI åŠ©æ‰‹/æœç´¢æ  (Right Sidebar) -->
    <aside class="right-sidebar">
      <div class="chat-header">
        <h3>AI åŠ©æ‰‹</h3>
        <span class="model-tag">Model V2</span>
      </div>

      <!-- èŠå¤©è®°å½•åŒºåŸŸ -->
      <div class="chat-history">
        <div v-for="(msg, i) in chatMessages" :key="i" class="message" :class="msg.role">
          <div class="avatar">{{ msg.role === 'user' ? 'ğŸ™‚' : 'ğŸ¤–' }}</div>
          <div class="bubble">
            <div class="bubble-name">{{ msg.name }}</div>
            <div class="bubble-text">{{ msg.content }}</div>
          </div>
        </div>
      </div>

      <!-- åº•éƒ¨å›ºå®šè¾“å…¥æ¡† -->
      <div class="input-area">
        <div class="input-wrapper">
          <textarea 
            v-model="userQuery" 
            placeholder="åœ¨æ­¤è¾“å…¥æ‚¨çš„é—®é¢˜..." 
            @keydown.enter.prevent="sendQuery"
          ></textarea>
          <button class="send-btn" @click="sendQuery">
            å‘é€
          </button>
        </div>
      </div>
    </aside>
  </div>
</template>

<script setup>
import { ref, reactive } from 'vue';

// --- æ¨¡æ‹Ÿæ•°æ®çŠ¶æ€ ---

// 1. ä¸»è¦æ ‡é¢˜
const sampleTitle = ref('å¦‚ä½•åˆ©ç”¨æ·±åº¦å¼ºåŒ–å­¦ä¹ ä¼˜åŒ–å¤šæ™ºèƒ½ä½“è·¯å¾„è§„åˆ’ï¼Ÿ');
const difficultyLevel = ref('hard'); // hard | simple

// 2. äº”ä¸ªæ­¥éª¤çš„æ•°æ® (æ¨¡æ‹ŸåŸæœ‰çš„ paperData/paper2Data/keywords)
// è¿™é‡Œå°†åˆ†æ•£çš„æ•°æ®æ•´åˆä¸ºä¸€ä¸ªç»“æ„æ•°ç»„ï¼Œæ–¹ä¾¿v-foræ¸²æŸ“
const steps = reactive([
  {
    column: 'èƒŒæ™¯è°ƒç ”',
    keyword: 'å¤šæ™ºèƒ½ä½“ç³»ç»ŸåŸºç¡€',
    paper1: {
      title: 'Multi-Agent Systems: A Survey',
      author: 'Wooldridge, M.',
      abstract: 'æœ¬æ–‡ç»¼è¿°äº†å¤šæ™ºèƒ½ä½“ç³»ç»Ÿçš„åŸºæœ¬æ¦‚å¿µï¼Œæ¢è®¨äº†åä½œä¸ç«äº‰ç¯å¢ƒä¸‹çš„äº¤äº’åè®®ã€‚'
    },
    paper2: {
      title: 'Reinforcement Learning: An Introduction',
      author: 'Sutton, R. & Barto, A.',
      abstract: 'å¼ºåŒ–å­¦ä¹ é¢†åŸŸçš„å¥ åŸºä¹‹ä½œï¼Œè¯¦ç»†ä»‹ç»äº†é©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹ã€‚'
    }
  },
  {
    column: 'æ ¸å¿ƒç®—æ³•',
    keyword: 'Q-Learning ä¼˜åŒ–',
    paper1: {
      title: 'Deep Q-Networks for Path Finding',
      author: 'Mnih, V. et al.',
      abstract: 'åˆ©ç”¨æ·±åº¦ç¥ç»ç½‘ç»œè¿‘ä¼¼Qå€¼å‡½æ•°ï¼Œè§£å†³äº†é«˜ç»´çŠ¶æ€ç©ºé—´çš„è·¯å¾„è§„åˆ’é—®é¢˜ã€‚'
    },
    paper2: null 
  },
  {
    column: 'æ¨¡å‹æ„å»º',
    keyword: 'ç¯å¢ƒå»ºæ¨¡ä¸ä»¿çœŸ',
    paper1: {
      title: 'Gym-Gazebo: Training Robots',
      author: 'Zamora, I.',
      abstract: 'ä»‹ç»äº†ä¸€ä¸ªç”¨äºè®­ç»ƒæœºå™¨äººå¯¼èˆªç®—æ³•çš„ä»¿çœŸç¯å¢ƒæ¶æ„ã€‚'
    },
    paper2: {
      title: 'Sim-to-Real Transfer',
      author: 'Tobin, J.',
      abstract: 'æ¢è®¨äº†å¦‚ä½•å°†ä»¿çœŸè®­ç»ƒçš„æ¨¡å‹è¿ç§»åˆ°çœŸå®ç‰©ç†æœºå™¨äººä¸Šã€‚'
    }
  },
  {
    column: 'å®éªŒéªŒè¯',
    keyword: 'æ¶ˆèå®éªŒä¸å¯¹æ¯”',
    paper1: {
      title: 'Benchmarking MARL Algorithms',
      author: 'Papoudakis, G.',
      abstract: 'å¯¹æ¯”äº†å¤šç§å¤šæ™ºèƒ½ä½“å¼ºåŒ–å­¦ä¹ ç®—æ³•åœ¨ä¸åŒåœºæ™¯ä¸‹çš„æ”¶æ•›é€Ÿåº¦ã€‚'
    },
    paper2: null
  },
  {
    column: 'æœªæ¥å±•æœ›',
    keyword: 'å±€é™æ€§ä¸æ”¹è¿›æ–¹å‘',
    paper1: {
      title: 'Safe Reinforcement Learning',
      author: 'Garcia, J.',
      abstract: 'æ€»ç»“äº†åœ¨å®‰å…¨å…³é”®å‹åº”ç”¨ä¸­éƒ¨ç½²å¼ºåŒ–å­¦ä¹ çš„é£é™©ä¸è§£å†³æ–¹æ¡ˆã€‚'
    },
    paper2: null
  }
]);

// 3. æ€»ç»“
const summaryContent = ref('é€šè¿‡åˆ†æ­¥å­¦ä¹ ï¼Œæˆ‘ä»¬äº†è§£åˆ°æ·±åº¦å¼ºåŒ–å­¦ä¹ åœ¨å¤šæ™ºèƒ½ä½“è·¯å¾„è§„åˆ’ä¸­å…·æœ‰å·¨å¤§æ½œåŠ›ï¼Œä½†ä¹Ÿé¢ä¸´è®­ç»ƒä¸ç¨³å®šå’Œè¿ç§»å›°éš¾çš„æŒ‘æˆ˜ã€‚å»ºè®®ä»åŸºç¡€Q-learningå…¥æ‰‹ï¼Œé€æ­¥è¿‡æ¸¡åˆ°Actor-Criticæ¶æ„ã€‚');

// 4. å³ä¾§èŠå¤©æ•°æ®
const userQuery = ref('');
const chatMessages = reactive([
  { role: 'ai', name: 'PaperBot', content: 'ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„è®ºæ–‡åŠ©æ‰‹ã€‚å¦‚æœä½ å¯¹å·¦ä¾§çš„æ­¥éª¤æœ‰ç–‘é—®ï¼Œæˆ–è€…æƒ³æœç´¢æ–°é—®é¢˜ï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ã€‚' }
]);

// --- æ–¹æ³•å®šä¹‰ ---

const handleRefresh = () => {
  alert('åˆ·æ–°å†…å®¹...');
  // é€»è¾‘ï¼šè°ƒç”¨åç«¯APIåˆ·æ–°
};

const handleGenerate = () => {
  // æ¨¡æ‹Ÿç”Ÿæˆé—®é¢˜
  sampleTitle.value = "æ–°çš„ç ”ç©¶è¯¾é¢˜ï¼š" + Math.random().toString(36).substring(7);
};

const goHome = () => {
  console.log('å›åˆ°é¦–é¡µ');
};

const filterNews = () => {
  console.log('æŸ¥çœ‹æ–°é—»é—®é¢˜');
};

const smartRecommend = () => {
  console.log('æ™ºèƒ½æ¨èè§¦å‘');
};

const sendQuery = () => {
  if (!userQuery.value.trim()) return;
  
  // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
  chatMessages.push({
    role: 'user',
    name: 'Me',
    content: userQuery.value
  });

  // æ¨¡æ‹ŸAIå›å¤
  setTimeout(() => {
    chatMessages.push({
      role: 'ai',
      name: 'PaperBot',
      content: `å…³äº "${userQuery.value}" çš„æŸ¥è¯¢ï¼Œæˆ‘æ‰¾åˆ°äº†å‡ ç¯‡ç›¸å…³æ–‡çŒ®ï¼Œå»ºè®®é‡ç‚¹å…³æ³¨ Transformer åœ¨è¯¥é¢†åŸŸçš„åº”ç”¨ã€‚`
    });
  }, 1000);

  userQuery.value = '';
};

</script>

<style scoped>
/* 
  å…¨å±€å¸ƒå±€è®¾ç½® 
  ä½¿ç”¨äº† Flexbox åˆ›å»ºä¸‰æ å¸ƒå±€
*/
.app-container {
  display: flex;
  height: 100vh;
  width: 100%;
  background-color: #f4f6f9; /* æŸ”å’Œçš„ç°èƒŒæ™¯ */
  font-family: 'Inter', 'Helvetica Neue', Helvetica, Arial, sans-serif;
  color: #333;
  overflow: hidden;
}

/* =========================================
   1. å·¦ä¾§ä¾§è¾¹æ æ ·å¼
   ========================================= */
.left-sidebar {
  width: 240px;
  background-color: #ffffff;
  border-right: 1px solid #e1e4e8;
  display: flex;
  flex-direction: column;
  padding: 20px;
  flex-shrink: 0;
  box-shadow: 2px 0 10px rgba(0,0,0,0.02);
  z-index: 10;
}

.brand {
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 20px;
  font-weight: 700;
  color: #4f46e5; /* ä¸»é¢˜è‰² Indigo */
  margin-bottom: 40px;
}

.nav-menu {
  display: flex;
  flex-direction: column;
  gap: 12px;
  flex: 1;
}

.nav-btn {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 16px;
  border: none;
  background: transparent;
  color: #555;
  font-size: 15px;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s;
  text-align: left;
}

.nav-btn:hover {
  background-color: #f3f4f6;
  color: #4f46e5;
}

.nav-btn.primary {
  background-color: #4f46e5;
  color: white;
  box-shadow: 0 4px 6px rgba(79, 70, 229, 0.2);
}

.nav-btn.primary:hover {
  background-color: #4338ca;
}

.divider {
  height: 1px;
  background-color: #e5e7eb;
  margin: 10px 0;
}

.bottom-status {
  margin-top: auto;
  font-size: 12px;
  color: #9ca3af;
  display: flex;
  align-items: center;
  gap: 6px;
}

.status-dot {
  width: 8px;
  height: 8px;
  background-color: #10b981;
  border-radius: 50%;
}

/* =========================================
   2. ä¸­é—´å†…å®¹åŒºæ ·å¼
   ========================================= */
.main-content {
  flex: 1;
  overflow-y: auto; /* å…è®¸å‚ç›´æ»šåŠ¨ */
  padding: 40px;
  background-color: #f8fafc;
}

/* é¡¶éƒ¨ Header */
.content-header {
  margin-bottom: 40px;
}

.topic-tag {
  font-size: 12px;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: #6b7280;
  font-weight: 600;
  margin-bottom: 8px;
}

.main-title {
  font-size: 28px;
  font-weight: 800;
  color: #111827;
  line-height: 1.3;
  margin-bottom: 16px;
}

.difficulty-badge {
  display: inline-block;
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
}
.difficulty-badge.hard {
  background-color: #fef2f2;
  color: #ef4444;
}
.difficulty-badge.simple {
  background-color: #ecfdf5;
  color: #10b981;
}

/* æ­¥éª¤å¡ç‰‡ */
.steps-container {
  display: flex;
  flex-direction: column;
  gap: 30px;
}

.step-card {
  display: flex;
  gap: 20px;
}

/* å·¦ä¾§çš„æ—¶é—´è½´çº¿ */
.step-indicator {
  display: flex;
  flex-direction: column;
  align-items: center;
  min-width: 60px;
}

.step-number {
  background-color: #4f46e5;
  color: white;
  font-size: 12px;
  font-weight: bold;
  padding: 4px 8px;
  border-radius: 6px;
  z-index: 2;
}

.step-line {
  flex: 1;
  width: 2px;
  background-color: #e5e7eb;
  margin-top: 8px;
  margin-bottom: -38px; /* è¿æ¥ä¸‹ä¸€ä¸ª */
}

/* å³ä¾§çš„å…·ä½“å†…å®¹ */
.step-content {
  flex: 1;
  background: white;
  border-radius: 12px;
  padding: 24px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.03);
  border: 1px solid #f3f4f6;
  transition: transform 0.2s;
}

.step-content:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(0,0,0,0.05);
}

.step-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  border-bottom: 1px solid #f3f4f6;
  padding-bottom: 12px;
}

.step-title {
  font-size: 18px;
  font-weight: 700;
  color: #1f2937;
  margin: 0;
}

.step-column-tag {
  background-color: #e0e7ff;
  color: #4338ca;
  padding: 4px 10px;
  border-radius: 6px;
  font-size: 12px;
  font-weight: 600;
}

/* è®ºæ–‡åˆ—è¡¨ */
.papers-list {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.paper-item {
  display: flex;
  gap: 12px;
  background-color: #f9fafb;
  padding: 12px;
  border-radius: 8px;
}

.paper-icon {
  font-size: 20px;
}

.paper-info {
  flex: 1;
}

.paper-title {
  margin: 0 0 4px 0;
  font-size: 15px;
  color: #111827;
  font-weight: 600;
}

.paper-author {
  margin: 0 0 8px 0;
  font-size: 13px;
  color: #6b7280;
}

.paper-abstract {
  font-size: 13px;
  color: #4b5563;
  line-height: 1.5;
  background: #fff;
  padding: 8px;
  border-radius: 6px;
  border: 1px solid #e5e7eb;
}

.no-paper {
  font-size: 13px;
  color: #9ca3af;
  font-style: italic;
  padding: 10px;
}

/* æœ€ç»ˆæ€»ç»“å¡ç‰‡ */
.final-summary-card {
  margin-top: 40px;
  background: linear-gradient(135deg, #4f46e5 0%, #6366f1 100%);
  color: white;
  border-radius: 16px;
  padding: 30px;
  box-shadow: 0 10px 25px rgba(79, 70, 229, 0.3);
}

.summary-header {
  font-size: 20px;
  font-weight: 700;
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.summary-body {
  font-size: 15px;
  line-height: 1.6;
  opacity: 0.95;
}

/* =========================================
   3. å³ä¾§ä¾§è¾¹æ æ ·å¼ (Fixed)
   ========================================= */
.right-sidebar {
  width: 320px;
  background-color: #ffffff;
  border-left: 1px solid #e1e4e8;
  display: flex;
  flex-direction: column;
  flex-shrink: 0;
  position: relative;
  z-index: 10;
}

.chat-header {
  padding: 20px;
  border-bottom: 1px solid #f3f4f6;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.chat-header h3 {
  margin: 0;
  font-size: 16px;
  font-weight: 700;
}

.model-tag {
  font-size: 10px;
  background: #f3f4f6;
  color: #6b7280;
  padding: 2px 6px;
  border-radius: 4px;
}

.chat-history {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 16px;
  padding-bottom: 100px; /* ä¸ºåº•éƒ¨è¾“å…¥æ¡†ç•™å‡ºç©ºé—´ */
}

.message {
  display: flex;
  gap: 10px;
}

.message.user {
  flex-direction: row-reverse;
}

.avatar {
  width: 32px;
  height: 32px;
  background: #eff6ff;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  flex-shrink: 0;
}

.message.ai .avatar {
  background: #e0e7ff;
}

.bubble {
  max-width: 80%;
  display: flex;
  flex-direction: column;
}

.bubble-name {
  font-size: 11px;
  color: #9ca3af;
  margin-bottom: 2px;
  text-align: left;
}
.message.user .bubble-name {
  text-align: right;
}

.bubble-text {
  padding: 10px 14px;
  border-radius: 12px;
  font-size: 13px;
  line-height: 1.4;
}

.message.ai .bubble-text {
  background-color: #f3f4f6;
  color: #1f2937;
  border-top-left-radius: 2px;
}

.message.user .bubble-text {
  background-color: #4f46e5;
  color: white;
  border-top-right-radius: 2px;
}

/* åº•éƒ¨è¾“å…¥æ¡† (ç»å¯¹å®šä½) */
.input-area {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  padding: 20px;
  background: white;
  border-top: 1px solid #f3f4f6;
}

.input-wrapper {
  display: flex;
  flex-direction: column;
  gap: 10px;
  background: #fff;
}

.input-wrapper textarea {
  width: 100%;
  height: 80px;
  padding: 12px;
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  resize: none;
  font-family: inherit;
  font-size: 13px;
  outline: none;
  transition: border-color 0.2s;
}

.input-wrapper textarea:focus {
  border-color: #4f46e5;
}

.send-btn {
  align-self: flex-end;
  background-color: #111827;
  color: white;
  border: none;
  padding: 8px 20px;
  border-radius: 6px;
  font-size: 13px;
  cursor: pointer;
}
.send-btn:hover {
  background-color: #000;
}

/* æ»šåŠ¨æ¡ç¾åŒ– */
::-webkit-scrollbar {
  width: 6px;
}
::-webkit-scrollbar-track {
  background: transparent;
}
::-webkit-scrollbar-thumb {
  background: #d1d5db;
  border-radius: 3px;
}
::-webkit-scrollbar-thumb:hover {
  background: #9ca3af;
}
</style>